<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data noupdate="1">
        <!-- Restrict External ID visibility by model and company -->

        <!-- HR users: only employee external IDs in allowed companies -->
        <record id="rule_external_id_hr_employee" model="ir.rule">
            <field name="name">External IDs - Employees (HR)</field>
            <field name="model_id" ref="model_external_id"/>
            <field name="groups" eval="[(4, ref('hr.group_hr_user'))]"/>
            <field name="domain_force">
                [("res_model", "=", "hr.employee"),
                 "|", ("company_id", "=", False), ("company_id", "in", company_ids)]
            </field>
        </record>

        <!-- Partner managers: only partner external IDs in allowed companies -->
        <record id="rule_external_id_partner" model="ir.rule">
            <field name="name">External IDs - Partners (Partner Manager)</field>
            <field name="model_id" ref="model_external_id"/>
            <field name="groups" eval="[(4, ref('base.group_partner_manager'))]"/>
            <field name="domain_force">
                [("res_model", "=", "res.partner"),
                 "|", ("company_id", "=", False), ("company_id", "in", company_ids)]
            </field>
        </record>

        <!-- Product managers: only product external IDs in allowed companies -->
        <record id="rule_external_id_product" model="ir.rule">
            <field name="name">External IDs - Products (Product Manager)</field>
            <field name="model_id" ref="model_external_id"/>
            <field name="groups" eval="[(4, ref('product.group_product_manager'))]"/>
            <field name="domain_force">
                [("res_model", "=", "product.product"),
                 "|", ("company_id", "=", False), ("company_id", "in", company_ids)]
            </field>
        </record>

        <!-- Global company isolation for all other users that may gain rights later -->
        <record id="rule_external_id_company_isolation" model="ir.rule">
            <field name="name">External IDs - Company Isolation</field>
            <field name="model_id" ref="model_external_id"/>
            <field name="domain_force">["|", ("company_id", "=", False), ("company_id", "in", company_ids)]</field>
            <field name="perm_read" eval="True"/>
            <field name="perm_write" eval="True"/>
            <field name="perm_unlink" eval="True"/>
            <field name="perm_create" eval="True"/>
        </record>
    </data>
</odoo>
